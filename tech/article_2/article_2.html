<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 6.12.3 (455520)"/><meta name="author" content="川島一朔"/><meta name="created" content="2017-11-22 02:02:17 +0000"/><meta name="source" content="desktop.win"/><meta name="source-application" content="evernote.win32"/><meta name="source-url" content="https://mail.google.com/mail/u/0/?ui=2&amp;view=btop&amp;ver=1qarjayb7dfsd&amp;q=osu&amp;qs=true&amp;search=query&amp;th=15fcdb1d6b0c2940&amp;qt=osu.1&amp;cvid=1"/><meta name="updated" content="2017-11-23 08:24:54 +0000"/><title>Open ViBEでP300 Speller を実践する</title></head><body><div><span style="font-size: 18px; font-weight: bold;">Open ViBEでP300 Speller を実践する</span></div><div><br/></div><div>執筆日：2017年11月23日</div><div>環境：CORE i5 7th Gen を積んだノートPC, Windows10, HD-72 (Cognionics Inc.)</div><div><br/></div><div><br/></div><div><b>Open ViBE とは</b></div><div><b><br/></b></div><div>Open ViBE という、様々な脳波解析・フィードバックを行うフリーソフトがある。</div><div><a href="http://openvibe.inria.fr">http://openvibe.inria.fr</a></div><div>GUI上で「ボックス」と呼ばれるモジュール（？）を繋げるだけで、簡単に解析プロトコルを組み立てることができる。</div><div>そのボックスの集まり、解析プロトコルの一連の流れを「シナリオ」と呼び、xml ファイルとして保存できる。</div><div><br/></div><div><br/></div><div><span style="font-weight: bold;">P300 Speller とは</span></div><div><br/></div><div>こいつのこと↓</div><div><a style="color: rgb(17, 85, 204); line-height: 1.45;" href="https://www.youtube.com/watch?v=hoKnQo9mfyQ">https://www.youtube.com/watch?v=hoKnQo9mfyQ</a></div><div>まず、指定されたアルファベットが光ったときのP300事象関連電位を機械学習する。</div><div>すると、頭の中で（自由に）選んだアルファベットを、機械が当てることができるようになる。というもの。</div><div><br/></div><div>Open ViBE にはデモとして、P300 Spelling のシナリオが入っている。<br/></div><div>下記リンクに解説があるので、こちらの通りにやればできるらしい。</div><div><a href="http://openvibe.inria.fr/openvibe-p300-speller/">http://openvibe.inria.fr/openvibe-p300-speller/</a></div><div><br/></div><div>今回は、Cognionics 製、HD-72という脳波計でこのシナリオを試してみる。</div><div>Cognionics も P300 speller を実行するためのWIKIページを用意している。</div><div><a href="http://cognionics.com/wiki/pmwiki.php/Main/Real-timeP300SpellerWithOpenVibe">http://cognionics.com/wiki/pmwiki.php/Main/Real-timeP300SpellerWithOpenVibe</a></div><div>もっとやりやすくなるようにシナリオに改良を加えているらしいが、肝心の改良版シナリオをDLするリンクが見つからない。</div><div>説明も途中で切れているように見えるし、編集途中なんだろうか。</div><div>諦めて、元のシナリオを実践する。</div><div><br/></div><div><br/></div><div><span style="font-weight: bold;">Open ViBE へ脳波データを転送する</span></div><div><br/></div><div><span style="line-height: 1.45;">Cognionics Data Acquisition を開き、脳波計HD-72と接続。</span></div><div>サンプリングレートが250だと後でエラーが出る。1000にしよう。</div><div><span style="line-height: 1.45;">[Start LabStreaming Layer] をクリックして、データを別ソフトへ転送できる状態にしておく。</span></div><div>openvibe acquisition server を起動する（管理者として実行しないと、後にエラーが出る場合もある？）。</div><div>Driver に、[LabStreamingLayer (LSL) (unstable)] を指定。</div><div>Connection Portは1024、Sample count per sent block に8。</div><div>[Preference] をクリックし、Drift Tolerance (ms) が8、Jitter Estimation Count For Drift が128になっていることを確認。</div><div>[connect] [play] をクリック。</div><div>メーター的なものが動き出せば成功。</div><div><br/></div><div><span style="line-height: 1.45;">OpenViBE Designer v1.3.0 を管理者として起動し（管理者としてじゃないと、脳波が保存できない）、[opens an existing scenario] のボタンをクリック。</span></div><div><span style="line-height: 1.45;">[Program Files (x86)/openvibe/share/openvibe/scenario/bci_examples/p300-xdawn-0-signal-monitoring.xml] というシナリオファイルを開いて、再生マークを押すと、脳波の様子をモニタリングできる。</span></div><div><br/></div><div>このあたりで脳波系を被験者にかぶせる。</div><div>きれいな脳波になるよう脳波計を調整する。</div><div>イマイチきれいじゃなくても、案外うまくいくようだ。</div><div><br/></div><div><br/></div><div><span style="font-weight: bold;">トレーニングデータを集める</span></div><div><br/></div><div>「このアルファベットを意識しているときはこのP300」というデータを集める。</div><div>p300-xdawn-1-acquisiton.xml のシナリオ開いて再生。</div><div>アルファベット盤が出てくるので、被験者に見ていてもらう。</div><div>20秒経過すると、アルファベットの内どれかが青く光る。</div><div>その後様々なアルファベットが白く光るので、初めに青く光ったアルファベットを見続けてもらう。</div><div>しばらく続けると、点滅が止まった後、また別のアルファベットが青く光る。</div><div>今度はそのアルファベットを見続ける。</div><div>これを繰り返すと、10分くらいで終了する。</div><div>signals というフォルダに、p300-xdawn-train-[日付].ov ファイルが出来上がる。</div><div>次に脳波を測るまで15分ほどかかるので、一旦脳波計は外してしまってよいだろう。</div><div><br/></div><div><br/></div><div><span style="font-weight: bold;">トレーニングデータに Spatial Filter をかける</span></div><div><br/></div><div>xDAWN というアルゴリズムを使い、脳波データに Spatial Filter をかける。</div><div>Spatial Filter というのは、特徴をうまく抽出するため脳波によく用いられるものらしい。</div><div>p300-xdawn-2-train-xDAWN.xmlを開く。</div><div>一番上にある、Generic stream reader のボックスをダブルクリック。</div><div>先程できた ov ファイルを指定して、[Apply]。</div><div><br/></div><div>シナリオを再生すると、(openvibe-designer.exe:15912): Gtk-WARNING **: というメッセージが出る。</div><div>しかしエラーメッセージというわけではないようだ。<br/></div><div>あくまで WARNING だけで動作はする。気にしないことにする。</div><div><br/></div><div>10分ほどで終了。<br/></div><div><br/></div><div><br/></div><div><span style="font-weight: bold;">Spatial Filter をかけたトレーニングデータをもとに学習を行う</span></div><div><br/></div><div>集めてきたデータを使って、「このアルファベットの時はこういうP300なんだなぁ」というパターンを機械に学習してもらう。</div><div>p300-xdawn-3-train-classifier.xml を開く。</div><div>Generic stream reader ボックスをダブルクリックして、先ほどと同じ ov ファイルを指定して再生。</div><div>この時も、管理者として実行していないとエラーを吐くので注意。</div><div>5分ほどで終了。</div><div>コマンドプロンプトの画面を見ると、Accuracy が表示される。</div><div>90% を超える精度のようだ。</div><div>適当につけたノイジー脳波なのにすごい。</div><div><br/></div><div><br/></div><div><b>学習がうまくいったかテスト</b></div><div><b><br/></b></div><div>いよいよ実践。再度脳波計を装着する。</div><div><span>p300-speller-3-online.xml を開いて再生。</span></div><div>再度アルファベット盤が出てくる。</div><div>先程と同様、文字のどれかひとつが青く光った後、様々なアルファベットが白く光る。</div><div>青く光った文字を見つめ続けてもいいが、自由に選んだアルファベットを見つめ続ける。</div><div>しばらくすると、被験者がどのアルファベットを見つめ続けていたか、脳波をもとに機械が判定してくれる。</div><div>緑色で光ったのが、機械が判定したアルファベット。</div><div>E, E, G という順番で見つめ続けたが、ちゃんとその通りに判定してくれた。すごい。</div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></body></html>